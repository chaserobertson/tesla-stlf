---
title: "intra_day"
output: html_document
date: "2023-05-01"
---

```{r}
source("./Functions.R")
library(mgcv)
```

Load and subset original 5-min 2014 data used by intra-day researchers.

```{r}
alldata <- read.csv("../../data/intra_day/original2014.csv")
alldata <- alldata[,c("Demand", "Temp", "DSTTime", "Year")]
head(alldata)
```

Compute time-weighted temperature and subset.

```{r}
alldata$WtdTemp <- wtdtemp(alldata$DSTTime, alldata$Temp)

fitdata <- alldata[((0*288)+1):(250*288),]  
#fitdata <- alldata

head(fitdata)
```

Fit best annual model 5.

```{r}
gamlwmod <- Demand ~  s(DSTTime, bs = "cc", k = 12) + s(WtdTemp, bs = "tp", k =8) + s(Year, bs = "tp", k =7)
wtdyear <- gamm(gamlwmod,  data = fitdata)
summary(wtdyear$gam)$r.sq
```

Show smooth terms.

```{r}
plot(wtdyear$gam, all.terms=T)
```

Apply same model to each year of 30-minute SA data (with half-hour temperatures interpolated).

```{r}
perf <- data.frame(year=2018:2022, r.sq=0)
for (year in perf$year) {
  df <- read.csv(paste("../../data/intra_day/", year, ".csv", sep=""))
  mdl <- gamm(gamlwmod,  data = df)
  perf[perf$year==year, "r.sq"] <- summary(mdl$gam)$r.sq
}
perf
```

Apply same model to each year of 30-minute NSW data (with half-hour temperatures from **Adelaide** interpolated). Historical hourly temperature data is hard to find - assuming weather conditions are similar enough across the two regions.

```{r}
perf <- data.frame(year=2018:2022, r.sq=0)
for (year in perf$year) {
  df <- read.csv(paste("../../data/intra_day/NSW_", year, ".csv", sep=""))
  mdl <- gamm(gamlwmod,  data = df)
  perf[perf$year==year, "r.sq"] <- summary(mdl$gam)$r.sq
}
perf
```
